<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>603 å®¿èˆç¼–å¹´å²ï¼šQS é£äº‘ä¸æ¨±èŠ±æ¢¦</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
<style>
    /* ------ å…¨å±€æ ·å¼ç³»ç»Ÿ ------ */
    :root {
        --main-pink: #ff92b9;
        --main-blue: #4facfe;
        --main-gold: #f0932b;
        --dark-bg: #1e1e24;
        --ui-overlay: rgba(30, 30, 36, 0.9);
    }

    body {
        margin: 0; padding: 0;
        background: #000;
        font-family: 'Noto Serif SC', 'Microsoft YaHei', serif;
        color: white;
        height: 100vh;
        width: 100vw;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        -webkit-user-select: none;
        user-select: none;
    }

    /* æ¸¸æˆå®¹å™¨ï¼šå›ºå®š 16:9ï¼Œæ‰‹æœºç«¯è‡ªåŠ¨ç¼©æ”¾ */
    #game-stage {
        position: relative;
        width: 100%; max-width: 1280px;
        aspect-ratio: 16/9;
        background-color: #222;
        background-size: cover;
        background-position: center;
        overflow: hidden;
        box-shadow: 0 0 60px rgba(0,0,0,0.8);
        transition: background-image 0.8s ease;
    }

    @media (max-aspect-ratio: 16/9) {
        #game-stage { width: 100%; height: auto; }
    }
    @media (min-aspect-ratio: 16/9) {
        #game-stage { height: 100%; width: auto; }
    }

    /* --- å›¾å±‚ç³»ç»Ÿ --- */
    .layer { position: absolute; inset: 0; pointer-events: none; transition: opacity 0.4s; }

    /* 1. ç«‹ç»˜å±‚ */
    #sprite-layer {
        z-index: 10;
        display: flex;
        justify-content: center;
        align-items: flex-end;
    }
    .sprite {
        height: 90%; /* è°ƒæ•´ç«‹ç»˜å¤§å° */
        width: auto;
        filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
        transform: translateY(50px);
        opacity: 0;
        transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s;
    }
    .sprite.show { transform: translateY(0); opacity: 1; }
    .sprite.shake { animation: shake 0.5s ease-in-out; }
    .sprite.hop { animation: hop 0.4s ease-in-out; }
    /* ç‰¹æ®Šå‘å…‰æ•ˆæœ */
    .glow-gold { filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.6)); }
    .glow-blue { filter: drop-shadow(0 0 20px rgba(0, 191, 255, 0.6)); }

    /* 2. UI å±‚ (å¯¹è¯æ¡†) */
    #ui-layer { z-index: 20; display: flex; flex-direction: column; justify-content: flex-end; padding-bottom: 2%; }
    
    .dialog-box {
        pointer-events: auto;
        background: linear-gradient(180deg, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.95) 40%);
        margin: 0 5%;
        border-top: 3px solid var(--main-pink);
        padding: 25px 40px;
        height: 180px;
        border-radius: 20px;
        position: relative;
        cursor: pointer;
    }
    
    .name-box {
        position: absolute;
        top: -25px; left: 20px;
        background: var(--main-pink);
        color: white;
        padding: 5px 30px;
        font-family: 'ZCOOL KuaiLe', cursive;
        font-size: 1.6rem;
        border-radius: 20px 20px 0 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        transition: background-color 0.3s;
    }
    
    .text-content {
        font-size: 1.4rem;
        line-height: 1.6;
        letter-spacing: 1px;
        color: #eee;
        text-shadow: 2px 2px 2px #000;
        margin-top: 15px;
        height: 120px;
        overflow: hidden;
    }
    
    /* æ‰“å­—å…‰æ ‡ */
    .cursor-blink::after { content: ' â–¼'; animation: blink 1s infinite; color: var(--main-pink); }

    /* 3. é€‰é¡¹å±‚ */
    #choice-overlay {
        z-index: 30;
        background: rgba(0,0,0,0.5);
        backdrop-filter: blur(5px);
        display: none; /* é»˜è®¤éšè— */
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 20px;
        pointer-events: auto;
    }

    .choice-btn {
        width: 60%;
        background: rgba(255,255,255,0.9);
        padding: 18px;
        text-align: center;
        font-size: 1.3rem;
        color: #333;
        font-weight: bold;
        border-radius: 50px;
        cursor: pointer;
        transition: 0.2s;
        border: 4px solid transparent;
    }
    .choice-btn:hover {
        transform: scale(1.05);
        border-color: var(--main-pink);
        color: var(--main-pink);
        background: white;
    }

    /* 4. æ ‡é¢˜ç•Œé¢å±‚ */
    #title-screen {
        z-index: 100;
        background: url('https://images.unsplash.com/photo-1492571350019-22de08371fd3?q=80&w=1920') center/cover;
        pointer-events: auto;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
    }
    #title-screen::before {
        content:''; position:absolute; inset:0; background: rgba(0,0,0,0.4);
    }
    
    .game-logo {
        position: relative;
        font-family: 'ZCOOL KuaiLe', cursive;
        font-size: clamp(3rem, 8vw, 6rem);
        color: white;
        text-shadow: 4px 4px 0 var(--main-pink), 8px 8px 15px rgba(0,0,0,0.8);
        margin-bottom: 20px;
        animation: float 3s ease-in-out infinite;
    }
    
    .start-btn {
        position: relative;
        padding: 15px 60px;
        font-size: 1.8rem;
        background: var(--main-pink);
        color: white;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 10px 30px rgba(255, 105, 180, 0.5);
        transition: transform 0.2s;
    }
    .start-btn:hover { transform: scale(1.1); background: #ff7eb3; }

    /* åŠŸèƒ½èœå• */
    .control-bar {
        position: absolute;
        top: 15px; right: 15px;
        z-index: 40;
        display: flex; gap: 10px;
        pointer-events: auto;
    }
    .c-btn {
        background: rgba(0,0,0,0.6);
        color: white;
        border: 1px solid rgba(255,255,255,0.3);
        padding: 5px 12px;
        border-radius: 5px;
        font-size: 0.9rem;
        cursor: pointer;
    }
    .c-btn:hover { background: white; color: black; }

    /* åŠ¨ç”» */
    @keyframes shake { 0%, 100% {transform:translateY(0) rotate(0);} 25%{transform:translateY(0) rotate(-2deg);} 75%{transform:translateY(0) rotate(2deg);} }
    @keyframes hop { 0%, 100% {transform:translateY(0);} 50% {transform:translateY(-30px);} }
    @keyframes blink { 0%,100% {opacity:0;} 50% {opacity:1;} }
    @keyframes float { 0%,100% {transform:translateY(0);} 50% {transform:translateY(-10px);} }
</style>
</head>
<body>

    <div id="game-stage">
        
        <!-- 0. èƒŒæ™¯ç‰¹æ•ˆ -->
        <div class="layer" id="bg-layer" style="background-image: url('https://images.unsplash.com/photo-1555854877-bab0e564b8d5');"></div>
        
        <!-- 1. è§’è‰²å±‚ -->
        <div class="layer" id="sprite-layer">
            <img id="char-img" class="sprite" src="" alt="Character">
        </div>

        <!-- 2. UI æ§åˆ¶ä¸æ–‡æœ¬ -->
        <div class="layer" id="ui-layer">
            <div class="control-bar">
                <div class="c-btn" onclick="Engine.save()">ä¿å­˜</div>
                <div class="c-btn" onclick="Engine.load()">è¯»å–</div>
                <div class="c-btn" onclick="Engine.skipMode()">å¿«è¿›</div>
            </div>
            
            <div class="dialog-box" onclick="Engine.next()">
                <div class="name-box" id="name-tag">???</div>
                <div class="text-content" id="text-box"></div>
            </div>
        </div>

        <!-- 3. é€‰é¡¹è¦†ç›–å±‚ -->
        <div class="layer" id="choice-overlay"></div>

        <!-- 4. æ ‡é¢˜ç•Œé¢ -->
        <div class="layer" id="title-screen">
            <div class="game-logo">603 å®¿èˆç‰©è¯­<br><span style="font-size: 0.4em; opacity:0.8;">Top 20 vs Japan Dream</span></div>
            <button class="start-btn" onclick="Engine.start()">START GAME</button>
            <p style="position:absolute; bottom:20px; opacity:0.6; font-size:0.9rem;">Made for Dormitory 603 | Ver 2.0 Full</p>
        </div>

    </div>

<script>
/**
 * =========================================
 *  ã€Part A: å‰§æœ¬é…ç½®åŒº (The Story)ã€‘
 *  è¿™é‡ŒåŒ…å«äº† 603 å®¿èˆçš„æ ¸å¿ƒå‰§æƒ…ï¼Œè¯·éšæ„ä¿®æ”¹
 * =========================================
 */
const ASSETS = {
    bg: {
        // ä½¿ç”¨ Unsplash é«˜æ¸…å›¾ä½œä¸ºå ä½èƒŒæ™¯
        dorm: "https://images.unsplash.com/photo-1555854877-bab0e564b8d5?q=80&w=1920", // å®¿èˆ
        class: "https://images.unsplash.com/photo-1580196969807-458542e136be?q=80&w=1920", // æ•™å®¤
        street_jp: "https://images.unsplash.com/photo-1503899036084-c55cdd92da26?q=80&w=1920", // æ—¥æœ¬è¡—é“é£æ ¼
        qs_hell: "https://images.unsplash.com/photo-1504190946260-181da1b3dbd6?q=80&w=1920", // å›¾ä¹¦é¦†åœ°ç‹±
        gold_aura: "linear-gradient(135deg, #2c3e50 0%, #000 100%)" // é‡‘å‡¯å³° BOSS èƒŒæ™¯
    },
    char: {
        // æ³¨æ„ï¼šä¸ºäº†ç¡®ä¿å¯è¿è¡Œï¼Œä½¿ç”¨åœ¨çº¿å ä½å›¾ã€‚
        // â˜…è¯·å°†è¿™äº› URL æ¢æˆä½ ä»¬çš„æŠ å›¾ PNGï¼â˜…
        huang: "hjr.png", 
        jin: "jkf-removebg-preview.png", 
        guo: "gwc.png"
    }
};

const SCRIPT = {
    "0": {
        bg: ASSETS.bg.dorm,
        name: "æˆ‘",
        text: "ï¼ˆçå¼€çœ¼ï¼‰â€¦â€¦ç†Ÿæ‚‰çš„å¤©èŠ±æ¿ã€‚603 å®¿èˆçš„æ—©æ™¨ä¾æ—§æ··åˆç€é›…æ€è¯æ±‡ä¹¦ã€switch æ‰‹æŸ„çš„çƒ­æ°”å’Œæ˜¨æ™šæ—¥æœ¬æ‹‰é¢çš„å‘³é“ã€‚",
        next: "1"
    },

    "1": {
        text: "ç©ºæ°”æœ‰ç‚¹å®‰é™ï¼Œå®‰é™å¾—ä¸åƒ 603ã€‚ç›´åˆ°â€”â€”",
        next: "2"
    },

    "2": {
        sound: "door_open",
        text: "çªç„¶ï¼Œä¸€é˜µæ€¥ä¿ƒçš„è„šæ­¥å£°ä»èµ°å»Šçˆ†å†²è€Œæ¥ã€‚",
        next: "3"
    },

    "3": {
        bg: ASSETS.bg.dorm,
        char: ASSETS.char.huang,
        anim: "hop",
        name: "é»„å®¶ç¿",
        color: "#ff92b9",
        text: "Yahuuï¼ï¼å…„å¼Ÿä»¬ï¼èµ·åºŠå•¦ï¼æˆ‘åˆšæ¢¦åˆ°æˆ‘åœ¨ç§‹å¶åŸçš„å¥³ä»†å’–å•¡å…ï¼å¤ªçˆ½äº†ï¼",
        next: "4"
    },

    "4": {
        name: "é»„å®¶ç¿",
        text: "è¿˜æœ‰è¿˜æœ‰ï¼æˆ‘æ˜¨å¤©ç”¨ Switch è¿åˆ·äº”å°æ—¶ã€Šå¡å°”è¾¾ã€‹ï¼ä»»å¤©å ‚ä¸‡å²ï¼ä½ çœ‹æˆ‘è¿™ä¸ªæ–°å‘å‹ï¼Œæ˜¯ä¸æ˜¯è¶…çº§ä¸œäº¬å¤ä»‡è€…é£ï¼Ÿï¼ˆæ‘†Poseï¼‰",
        choices: [
            { text: "ç¡®å®å¸…ï¼Œ603 é¢œå€¼å·…å³°éä½ è«å±ã€‚", target: "huang_happy" },
            { text: "æ¯”èµ·å‘å‹ï¼Œä½ é›…æ€å¤ä¹ äº†å—ï¼Ÿ", target: "huang_shock" },
            { text: "æ— è§†ä»–ï¼Œç»§ç»­ç¡ã€‚", target: "huang_ignore" }
        ]
    },

    // --- åˆ†æ”¯ A: å¤¸å¥–é»„å®¶ç¿ ---
    "huang_happy": {
        char: ASSETS.char.huang,
        anim: "hop",
        text: "å“ˆå“ˆï¼æœç„¶ä½ æ‡‚æˆ‘ï¼åªè¦å¿ƒä¸­æœ‰äºŒæ¬¡å…ƒï¼Œå“ªé‡Œéƒ½æ˜¯ä¸œäº¬ï¼å¥½æ„Ÿåº¦ +10ï¼",
        next: "jin_entry"
    },

    // --- åˆ†æ”¯ B: æ‰“å‡»é»„å®¶ç¿ ---
    "huang_shock": {
        char: ASSETS.char.huang,
        anim: "shake",
        text: "Guâ€”â€”ï¼ä¸ºä»€ä¹ˆå¤§æ—©ä¸Šè¦æè¿™ç§ä¸œè¥¿ï¼ä½ æ˜¯é­”é¬¼å—ï¼",
        next: "jin_entry"
    },

    // --- åˆ†æ”¯ C: æ— è§† ---
    "huang_ignore": {
        text: "é»„å®¶ç¿æ²‰é»˜äº†ä¸€ä¸‹ï¼Œåªèƒ½é»˜é»˜æ‰“å¼€ B ç«™èˆè¹ˆåŒºç»§ç»­å­¦èˆã€‚",
        next: "jin_entry"
    },

    // --- æ ¸å¿ƒå‰§æƒ…ï¼šBoss å…¥åœº ---
    "jin_entry": {
        bg: ASSETS.bg.gold_aura,
        char: null,
        text: "çªç„¶ï¼Œå®¿èˆæ°”å‹æ˜æ˜¾å˜ä½ã€‚é—¨å£ç«™ç€ä¸€ä¸ªè‡ªå¸¦é‡‘è‰² aura çš„ç”·äººã€‚",
        next: "jin_show"
    },

    "jin_show": {
        char: ASSETS.char.jin,
        anim: "hop",
        name: "é‡‘å‡¯å³°",
        color: "#f0932b",
        text: "åµä»€ä¹ˆåµï¼Ÿç°åœ¨å¯æ˜¯ QS Top 20 ç”³è¯·å…³é”®æœŸã€‚ä½ ä»¬åµæˆè¿™æ ·ï¼Œä¼šå¹²æ‰°æˆ‘åƒæ­£æ–°é¸¡æ’æ—¶çš„å†¥æƒ³æ•ˆç‡ã€‚",
        next: "jin_talk2"
    },

    "jin_talk2": {
        name: "é‡‘å‡¯å³°",
        text: "è¿˜æœ‰ä½ ï¼Œå®¶ç¿ã€‚å¤©å¤©ä»»å¤©å ‚ã€ä»»å¤©å ‚â€¦â€¦ä½ çš„ GPA é…å¾—ä¸Šä¸œå¤§å—ï¼Ÿ",
        next: "confrontation"
    },

    "confrontation": {
        char: ASSETS.char.huang,
        name: "é»„å®¶ç¿",
        text: "ä½ â€¦â€¦ä½ åˆæ¥äº†ï¼æˆ‘è¿½çš„æ˜¯çµé­‚è‡ªç”±ï¼æ˜¯æ¨±èŠ±æ ‘ä¸‹çš„èª“è¨€ï¼ä¸æ˜¯ä½ çš„ç ´æ’åï¼",
        next: "guo_entry"
    },

    // --- æ ¸å¿ƒå‰§æƒ…ï¼šéƒ­ä¼ŸåŸå…¥åœº ---
    "guo_entry": {
        bg: ASSETS.bg.dorm,
        char: ASSETS.char.guo,
        anim: "hop",
        name: "éƒ­ä¼ŸåŸ",
        color: "#4facfe",
        text: "cnmï¼Œéƒ½ç»™æˆ‘é—­å˜´ä¸€ä¸‹ã€‚é ï¼Œå¤§æ—©ä¸Šåµæˆè¿™æ ·ã€‚æ ¹æ®æˆ‘åˆ†æï¼Œé‡‘å‡¯å³°æ‹¿ Offer çš„æ¦‚ç‡ 98.5%ï¼Œå®¶ç¿å¦‚æœè¿‡è¯­è¨€å…³ä¹Ÿæœ‰ 80%ã€‚",
        next: "guo_logic"
    },

    "guo_logic": {
        name: "éƒ­ä¼ŸåŸ",
        text: "åæ­£äº‰ä¹Ÿæ²¡ç”¨ã€‚æˆ‘ä»¬æœ€åéƒ½ä¼šæ¯•ä¸šã€‚ä¸å¦‚å…ˆå»åƒé¥­ã€‚æˆ‘ä¸€é¥¿å°±æƒ³éª‚ä½ è€å†¯ã€‚",
        next: "major_choice"
    },

    // === ã€é‡å¤§æŠ‰æ‹©ã€‘ è·¯çº¿åˆ†æ­§ ===
    "major_choice": {
        name: "ç³»ç»Ÿ",
        text: "å®¿èˆçš„æ°”æ°›å˜å¾—å¾®å¦™ã€‚ä½ å†³å®šç«™åœ¨å“ªä¸€è¾¹ï¼Ÿ",
        choices: [
            { text: "ã€æ¨±èŠ±çº¿ã€‘æ”¯æŒé»„å®¶ç¿ï¼Œä¸ºäº†æ¢¦æƒ³ï¼", target: "route_japan_start" },
            { text: "ã€å­¦éœ¸çº¿ã€‘æ”¯æŒé‡‘å‡¯å³°ï¼Œè¿½æ±‚ QS æ’åã€‚", target: "route_qs_start" },
            { text: "ã€ä¸­ç«‹çº¿ã€‘è·Ÿéƒ­ä¼ŸåŸåƒé¥­ï¼Œç¨³æ‰ç¨³æ‰“ã€‚", target: "route_peace_start" }
        ]
    },

    // ============================
    //   çº¿è·¯ 1ï¼šæ¨±èŠ±æ¢¦æƒ³ (Japan Route)
    // ============================
    "route_japan_start": {
        bg: ASSETS.bg.street_jp,
        char: ASSETS.char.huang,
        name: "é»„å®¶ç¿",
        text: "æˆ‘æ—©å°±çŸ¥é“ä½ æ‡‚æˆ‘ï¼æ¥ï¼Œæˆ‘ç»™ä½ å±•ç¤ºæˆ‘ç­–åˆ’çš„ã€Šä¸œäº¬åˆ¶éœ¸è·¯çº¿å›¾ã€‹ï¼ä»»å¤©å ‚æ€»éƒ¨ä¹Ÿåœ¨æ¸…å•é‡Œï¼",
        next: "jp_1"
    },
    "jp_1": {
        text: "ä»–å…´å¥‹åœ°å±•å¼€ä¸€å¼ å·¨å¤§çš„åœ°å›¾ï¼Œä¸Šé¢æ»¡æ˜¯åœ£åœ°å·¡ç¤¼æ ‡è®°ã€ç§‹å¶åŸè¡—åŒºæ ‡è®°ï¼Œè¿˜æœ‰ä»»å¤©å ‚æ€»éƒ¨å¤§æ¥¼çš„å°è´´çº¸ã€‚",
        next: "jp_2"
    },
    "jp_2": {
        name: "é»„å®¶ç¿",
        text: "åªè¦æˆ‘ä»¬åŠªåŠ›ï¼Œæ˜å¹´æ˜¥å¤©å°±èƒ½ç«™åœ¨ç›®é»‘å·ï¼Œçœ‹æ¨±èŠ±é£˜è½ã€‚å‘ï¼Œè¿™æ˜¯çº¦å®šå“¦ï¼",
        next: "jp_end"
    },
    "jp_end": {
        bg: "#000",
        char: null,
        name: "Ending",
        text: "ã€Happy Endï¼šæ¨±èŠ±æ ‘ä¸‹çš„çº¦å®šã€‘\nä½ å’Œé»„å®¶ç¿æˆä¸ºäº†æœ€å¼ºäºŒæ¬¡å…ƒæ­æ¡£ã€‚",
        end: true
    },

    // ============================
    //   çº¿è·¯ 2ï¼šQS äº‰éœ¸ (Elite Route)
    // ============================
    "route_qs_start": {
        bg: ASSETS.bg.qs_hell,
        char: ASSETS.char.jin,
        name: "é‡‘å‡¯å³°",
        text: "ä¸é”™ã€‚ä½ æœç„¶æ˜¯çœ‹é‡æœªæ¥çš„äººã€‚æ¥ï¼Œè¿™æœ¬ã€Šå¸¸æ˜¥è—¤ç”³è¯·ç§˜ç±ã€‹ç»™ä½ ã€‚è¾¹åƒç‚¸é¸¡è¾¹å­¦ï¼Œæ•ˆæœç¿»å€ã€‚",
        next: "qs_1"
    },
    "qs_1": {
        text: "é‡‘å‡¯å³°ç¥æƒ…ä¸¥è‚ƒï¼Œå´ä¸€æ‰‹æ‹¿ç€ç‚¸é¸¡ï¼Œä¸€æ‰‹å°†åšåšçš„ç§˜ç±å¡ç»™ä½ ã€‚",
        next: "qs_2"
    },
    "qs_2": {
        name: "é‡‘å‡¯å³°",
        text: "ä»ç°åœ¨èµ·ï¼Œä½ è¦æˆ’æ‡’è§‰ã€æˆ’æ¸¸æˆã€æˆ’ä½æ•ˆåŠªåŠ›ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ˜Ÿè¾°å¤§æµ·ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå°å°çš„å²›å›½ã€‚",
        next: "qs_end"
    },
    "qs_end": {
        bg: "#000",
        char: null,
        name: "Ending",
        text: "ã€True Endï¼šç²¾è‹±çš„ä¿¯ç°ã€‘\nåœ¨é‡‘å‡¯å³°çš„æŒ‡å¯¼ä¸‹ï¼Œä½ çš„ GPA é£™å‡ï¼Œæˆä¸º603ç¬¬äºŒä½ä¼ è¯´ã€‚",
        end: true
    },

    // ============================
    //   çº¿è·¯ 3ï¼šå’Œå¹³æ—¥å¸¸ (Peace Route)
    // ============================
    "route_peace_start": {
        bg: ASSETS.bg.dorm,
        char: ASSETS.char.guo,
        name: "éƒ­ä¼ŸåŸ",
        text: "æ˜æ™ºã€‚ä¸å…¶åµæ¶ï¼Œä¸å¦‚å…ˆåƒé¥­ã€‚å¦ˆçš„æˆ‘å¿«é¥¿æ­»äº†ã€‚",
        next: "peace_1"
    },
    "peace_1": {
        text: "æœ€åï¼Œ603 å››äººååœ¨é£Ÿå ‚ã€‚é‡‘å‡¯å³°å«Œå¼ƒé¥­èœï¼Œé»„å®¶ç¿è®¨è®ºæ–°ç•ªï¼Œéƒ­ä¼ŸåŸç–¯ç‹‚åæ§½è¥å…»æˆåˆ†ã€‚",
        next: "peace_end"
    },
    "peace_end": {
        bg: "#000",
        char: null,
        name: "Ending",
        text: "ã€Normal Endï¼š603 çš„æ°¸æ’æ—¥å¸¸ã€‘\nèšæ˜¯ä¸€å›¢ç«ï¼Œæ•£æ˜¯æ»¡å¤©æ˜Ÿã€‚è¿™å°±æ˜¯é’æ˜¥ã€‚",
        end: true
    }
};


/**
 * =========================================
 *  ã€Part B: æ¸¸æˆå¼•æ“å†…æ ¸ (Engine Core)ã€‘
 *  è¯·å‹¿ä¿®æ”¹ä¸‹æ–¹çš„é€»è¾‘ä»£ç ï¼Œé™¤éä½ æ‡‚ JS
 * =========================================
 */
const Engine = {
    currentId: '0',
    isTyping: false,
    autoMode: false,
    
    // åˆå§‹åŒ–
    init() {
        // ç»‘å®šé”®ç›˜äº‹ä»¶
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'Enter') this.next();
        });
    },

    // 1. å¼€å§‹æ¸¸æˆ
    start() {
        const ts = document.getElementById('title-screen');
        ts.style.opacity = 0;
        setTimeout(() => {
            ts.style.display = 'none';
            this.loadScene('0'); // ä» ID 0 å¼€å§‹
        }, 500);
    },

    // 2. åŠ è½½åœºæ™¯
    loadScene(id) {
        if (!SCRIPT[id]) {
            console.error('Script Error: Scene ID not found ->', id);
            return;
        }
        this.currentId = id;
        const data = SCRIPT[id];

        // è®¾ç½®èƒŒæ™¯
        if (data.bg) {
            const bgLayer = document.getElementById('bg-layer');
            if (data.bg.startsWith('#') || data.bg.startsWith('linear')) {
                bgLayer.style.backgroundImage = 'none';
                bgLayer.style.background = data.bg;
            } else {
                bgLayer.style.backgroundImage = `url('${data.bg}')`;
            }
        }

        // è®¾ç½®ç«‹ç»˜
        const charImg = document.getElementById('char-img');
        if (data.char === null) {
            charImg.classList.remove('show');
            setTimeout(() => { charImg.src = ''; }, 400); // Wait fade out
        } else if (data.char) {
            // å¦‚æœåˆ‡å›¾ç‰‡äº†æ‰åŠ¨ä½œ
            if (!charImg.src.includes(data.char)) {
                charImg.src = data.char;
                // ç®€å•çš„å‡ºåœºåŠ¨ç”»é‡ç½®
                charImg.classList.remove('show', 'shake', 'hop');
                void charImg.offsetWidth; // trigger reflow
                charImg.classList.add('show');
                if (data.anim) charImg.classList.add(data.anim);
                
                // ç‰¹æ®Šå…‰æ•ˆ
                charImg.className = `sprite show ${data.anim || ''}`;
                if (data.name === 'é‡‘å‡¯å³°') charImg.classList.add('glow-gold');
                else if (data.name === 'éƒ­ä¼ŸåŸ') charImg.classList.add('glow-blue');
            }
        }

        // åå­—æ é¢œè‰²
        const nameBox = document.getElementById('name-tag');
        if (data.name) {
            nameBox.style.opacity = 1;
            nameBox.innerText = data.name;
            nameBox.style.background = data.color || 'var(--main-pink)';
        } else {
            nameBox.style.opacity = 0;
        }

        // æ–‡æœ¬æ‰“å­—æœº
        const textBox = document.getElementById('text-box');
        this.isTyping = true;
        textBox.innerHTML = '';
        textBox.className = 'text-content cursor-blink'; // æ­£åœ¨æ‰“å­—
        
        let i = 0;
        const txt = data.text;
        const speed = this.autoMode ? 10 : 30;

        if (this.timer) clearInterval(this.timer);
        this.timer = setInterval(() => {
            if (!this.isTyping) {
                // ç¬é—´å®Œæˆ
                textBox.innerHTML = txt;
                clearInterval(this.timer);
                this.checkChoices(data);
                return;
            }
            textBox.innerHTML += txt.charAt(i);
            i++;
            if (i >= txt.length) {
                this.isTyping = false;
                textBox.classList.remove('cursor-blink'); // æ‰“å®Œå­—ç§»é™¤å…‰æ ‡
                clearInterval(this.timer);
                this.checkChoices(data);
            }
        }, speed);
    },

    // 3. æ£€æŸ¥æ˜¯å¦éœ€è¦æ˜¾ç¤ºé€‰é¡¹
    checkChoices(data) {
        if (data.choices) {
            const overlay = document.getElementById('choice-overlay');
            overlay.innerHTML = ''; // æ¸…ç©ºæ—§é€‰é¡¹
            overlay.style.display = 'flex';
            
            data.choices.forEach(choice => {
                const btn = document.createElement('div');
                btn.className = 'choice-btn';
                btn.innerText = choice.text;
                btn.onclick = (e) => {
                    e.stopPropagation();
                    overlay.style.display = 'none';
                    this.loadScene(choice.target);
                };
                overlay.appendChild(btn);
            });
        }
        
        // å¦‚æœæ˜¯ç»“å±€
        if (data.end) {
            setTimeout(() => {
                alert("ğŸ‰ è¾¾æˆç»“å±€ï¼æ„Ÿè°¢æ¸¸ç© 603 ç‰©è¯­ã€‚");
                location.reload();
            }, 1000);
        }
    },

    // 4. ç‚¹å‡»â€œä¸‹ä¸€æ­¥â€
    next() {
        const data = SCRIPT[this.currentId];
        // æ­£åœ¨æ‰“å­— -> ç¬é—´æ˜¾ç¤º
        if (this.isTyping) {
            this.isTyping = false; 
            return;
        }
        // æœ‰é€‰é¡¹æˆ–ç»“æŸ -> ç¦æ­¢ç‚¹å‡»ä¸‹ä¸€é¡µ
        if (data.choices || data.end) return;
        
        if (data.next) {
            this.loadScene(data.next);
        } else {
            console.log('No next scene define');
        }
    },

    // 5. å­˜æ¡£è¯»æ¡£åŠŸèƒ½ (ä½¿ç”¨ localStorage)
    save() {
        localStorage.setItem('603Gal_SaveData', this.currentId);
        alert('ğŸ’¾ è¿›åº¦å·²ä¿å­˜ï¼');
    },
    load() {
        const save = localStorage.getItem('603Gal_SaveData');
        if (save && SCRIPT[save]) {
            this.loadScene(save);
        } else {
            alert('âŒ æ²¡æœ‰æ‰¾åˆ°å­˜æ¡£ï¼');
        }
    },
    
    // 6. å¿«è¿›æ¨¡å¼
    skipMode() {
        this.autoMode = !this.autoMode;
        alert(this.autoMode ? "å¿«è¿›æ¨¡å¼ï¼šå¼€å¯ (ç‚¹å‡»å¯¹è¯å¿«é€Ÿè·³è¿‡)" : "å¿«è¿›æ¨¡å¼ï¼šå…³é—­");
    }
};

// å¯åŠ¨åˆå§‹åŒ–
Engine.init();

</script>
</body>
</html>